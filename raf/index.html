<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Outreach Platform</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg: #0a0a0a;
      --text: #e8e8e8;
      --text-muted: #888;
      --accent: #fff;
      --border: rgba(255,255,255,0.1);
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--text);
      overflow-x: hidden;
      line-height: 1.6;
    }

    .noise {
      position: fixed;
      inset: 0;
      opacity: 0.02;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' /%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' /%3E%3C/svg%3E");
      pointer-events: none;
      z-index: 1;
    }

    /* Password Screen */
    #password-screen {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 2rem;
    }

    .password-container {
      max-width: 500px;
      width: 100%;
      text-align: center;
    }

    .password-container h1 {
      font-size: clamp(2.5rem, 5vw, 4rem);
      font-weight: 300;
      line-height: 1.2;
      margin-bottom: 1rem;
      letter-spacing: -0.02em;
    }

    .password-container p {
      color: var(--text-muted);
      font-size: 0.95rem;
      margin-bottom: 3rem;
      font-weight: 300;
    }

    .input-wrapper {
      position: relative;
      margin-bottom: 1.5rem;
    }

    .input-wrapper label {
      display: block;
      font-size: 0.75rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: 0.8rem;
      text-align: left;
    }

    #password-input {
      width: 100%;
      padding: 1.2rem 1.5rem;
      background: rgba(255,255,255,0.02);
      border: 1px solid var(--border);
      color: var(--text);
      font-size: 1rem;
      font-family: 'Inter', sans-serif;
      font-weight: 400;
      transition: all 0.3s;
      letter-spacing: 0.02em;
    }

    #password-input:focus {
      outline: none;
      border-color: rgba(255,255,255,0.3);
      background: rgba(255,255,255,0.03);
    }

    #password-input::placeholder {
      color: var(--text-muted);
      opacity: 0.5;
    }

    #submit-btn {
      width: 100%;
      padding: 1.2rem;
      background: transparent;
      border: 1px solid var(--accent);
      color: var(--accent);
      font-size: 0.85rem;
      font-weight: 400;
      font-family: 'Inter', sans-serif;
      cursor: pointer;
      transition: all 0.3s;
      letter-spacing: 0.2em;
      text-transform: uppercase;
    }

    #submit-btn:hover {
      background: var(--accent);
      color: var(--bg);
    }

    #error-msg {
      color: var(--text-muted);
      margin-top: 1.5rem;
      font-size: 0.85rem;
      display: none;
      font-weight: 300;
    }

    /* Main Content */
    #main-content {
      display: none;
      padding: 4rem 4rem 6rem;
      max-width: 1800px;
      margin: 0 auto;
      position: relative;
      z-index: 2;
      opacity: 0;
      animation: contentFade 1s forwards;
    }

    @keyframes contentFade {
      to { opacity: 1; }
    }

    .header-section {
      margin-bottom: 4rem;
      padding-bottom: 3rem;
      border-bottom: 1px solid var(--border);
    }

    .header-section h1 {
      font-size: clamp(2.5rem, 5vw, 5rem);
      font-weight: 300;
      line-height: 1.2;
      margin-bottom: 0.5rem;
      letter-spacing: -0.02em;
    }

    .header-section p {
      color: var(--text-muted);
      font-size: 1rem;
      font-weight: 300;
    }

    .metrics-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 3rem;
      margin-bottom: 4rem;
    }

    .metric {
      border-top: 1px solid var(--border);
      padding-top: 1.5rem;
    }

    .metric-label {
      font-size: 0.75rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: 1rem;
    }

    .metric-value {
      font-size: clamp(2.5rem, 4vw, 4rem);
      font-weight: 300;
      line-height: 1;
      letter-spacing: -0.02em;
    }

    .controls {
      display: flex;
      gap: 1.5rem;
      margin-bottom: 3rem;
      flex-wrap: wrap;
    }

    .search-container {
      flex: 1;
      min-width: 300px;
      position: relative;
    }

    .search-container input {
      width: 100%;
      padding: 1rem 1.5rem;
      background: rgba(255,255,255,0.02);
      border: 1px solid var(--border);
      color: var(--text);
      font-size: 0.9rem;
      font-family: 'Inter', sans-serif;
      transition: all 0.3s;
    }

    .search-container input:focus {
      outline: none;
      border-color: rgba(255,255,255,0.3);
      background: rgba(255,255,255,0.03);
    }

    .search-container input::placeholder {
      color: var(--text-muted);
      opacity: 0.5;
    }

    .filter-group {
      display: flex;
      gap: 1rem;
    }

    .filter-btn {
      padding: 1rem 2rem;
      background: rgba(255,255,255,0.02);
      border: 1px solid var(--border);
      color: var(--text-muted);
      font-size: 0.75rem;
      font-weight: 400;
      cursor: pointer;
      transition: all 0.3s;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      font-family: 'Inter', sans-serif;
    }

    .filter-btn:hover {
      border-color: rgba(255,255,255,0.3);
      color: var(--text);
    }

    .filter-btn.active {
      background: rgba(255,255,255,0.05);
      border-color: var(--accent);
      color: var(--accent);
    }

    .table-wrapper {
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.02);
      overflow: hidden;
    }

    .table-container {
      overflow-x: auto;
      overflow-y: auto;
      max-height: 800px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
    }

    thead {
      position: sticky;
      top: 0;
      z-index: 10;
      background: rgba(10,10,10,0.95);
      backdrop-filter: blur(20px);
    }

    th {
      padding: 1.5rem 2rem;
      text-align: left;
      font-weight: 400;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-muted);
      border-bottom: 1px solid var(--border);
      white-space: nowrap;
    }

    tbody tr {
      border-bottom: 1px solid var(--border);
      transition: background 0.3s;
    }

    tbody tr:hover {
      background: rgba(255,255,255,0.03);
    }

    td {
      padding: 1.5rem 2rem;
      color: var(--text);
      font-weight: 300;
      vertical-align: middle;
    }

    td:first-child {
      font-weight: 400;
    }

    a {
      color: var(--accent);
      text-decoration: none;
      transition: opacity 0.3s;
      position: relative;
    }

    a::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 0;
      height: 1px;
      background: var(--accent);
      transition: width 0.3s;
    }

    a:hover {
      opacity: 0.7;
    }

    a:hover::after {
      width: 100%;
    }

    .status-badge {
      display: inline-block;
      padding: 0.4rem 1rem;
      font-size: 0.7rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.02);
    }

    .status-contacted {
      border-color: rgba(255,255,255,0.3);
      color: var(--text);
    }

    .status-pending {
      color: var(--text-muted);
    }

    .priority {
      font-size: 0.9rem;
      letter-spacing: 0.2em;
      color: var(--text-muted);
    }

    .loading {
      text-align: center;
      padding: 6rem 2rem;
      color: var(--text-muted);
    }

    .loading-line {
      width: 200px;
      height: 1px;
      background: var(--border);
      margin: 0 auto 2rem;
      position: relative;
      overflow: hidden;
    }

    .loading-line::after {
      content: '';
      position: absolute;
      inset: 0;
      background: var(--accent);
      transform: translateX(-100%);
      animation: loadLine 2s ease-in-out infinite;
    }

    @keyframes loadLine {
      to { transform: translateX(100%); }
    }

    @media (max-width: 768px) {
      #main-content {
        padding: 3rem 2rem;
      }

      .controls {
        flex-direction: column;
      }

      .search-container {
        width: 100%;
        min-width: auto;
      }

      .filter-group {
        flex-wrap: wrap;
      }

      th, td {
        padding: 1rem;
        font-size: 0.8rem;
      }

      .metrics-row {
        grid-template-columns: 1fr;
        gap: 2rem;
      }
    }
  </style>
</head>
<body>
  <div class="noise"></div>

  <!-- Password Screen -->
  <div id="password-screen">
    <div class="password-container">
      <h1>Hello Raf,</h1>
      <p>Enter your access code to continue</p>
      <div class="input-wrapper">
        <label>Access Code</label>
        <input 
          type="password" 
          id="password-input" 
          placeholder="Enter password"
          autocomplete="off"
        >
      </div>
      <button id="submit-btn">Authenticate</button>
      <div id="error-msg">Invalid credentials. Please try again.</div>
    </div>
  </div>

  <!-- Main Content -->
  <div id="main-content">
    <div class="header-section">
      <h1>Let's get you on some podcasts, shall we?</h1>
      <p>Real-time outreach tracking and management</p>
    </div>
    
    <div class="metrics-row">
      <div class="metric">
        <div class="metric-label">Total Targets</div>
        <div class="metric-value" id="total-count">—</div>
      </div>
      <div class="metric">
        <div class="metric-label">Contacted</div>
        <div class="metric-value" id="contacted-count">—</div>
      </div>
      <div class="metric">
        <div class="metric-label">Responses</div>
        <div class="metric-value" id="response-count">—</div>
      </div>
      <div class="metric">
        <div class="metric-label">Success Rate</div>
        <div class="metric-value" id="success-rate">—</div>
      </div>
    </div>
    
    <div class="controls">
      <div class="search-container">
        <input type="text" id="search-input" placeholder="Search podcasts, hosts, or topics...">
      </div>
      <div class="filter-group">
        <button class="filter-btn active" data-filter="all">All</button>
        <button class="filter-btn" data-filter="contacted">Contacted</button>
        <button class="filter-btn" data-filter="pending">Pending</button>
        <button class="filter-btn" data-filter="responded">Responded</button>
      </div>
    </div>
    
    <div class="table-wrapper">
      <div class="table-container">
        <div class="loading">
          <div class="loading-line"></div>
          <p>Loading data stream...</p>
        </div>
        
        <table id="outreach">
          <thead>
            <tr>
              <th>Podcast</th>
              <th>Host</th>
              <th>Niche</th>
              <th>Audience</th>
              <th>Email</th>
              <th>Instagram</th>
              <th>LinkedIn</th>
              <th>Website</th>
              <th>Region</th>
              <th>Status</th>
              <th>Last Contact</th>
              <th>Response</th>
              <th>Next Action</th>
              <th>Priority</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    // Authentication
    const correctPassword = "PodcastKing";
    const passwordScreen = document.getElementById("password-screen");
    const mainContent = document.getElementById("main-content");
    const passwordInput = document.getElementById("password-input");
    const submitBtn = document.getElementById("submit-btn");
    const errorMsg = document.getElementById("error-msg");

    function checkPassword() {
      if (passwordInput.value === correctPassword) {
        passwordScreen.style.transition = "opacity 0.5s";
        passwordScreen.style.opacity = "0";
        setTimeout(() => {
          passwordScreen.style.display = "none";
          mainContent.style.display = "block";
          loadSheet();
        }, 500);
      } else {
        errorMsg.style.display = "block";
        passwordInput.value = "";
        passwordInput.focus();
        setTimeout(() => errorMsg.style.display = "none", 3000);
      }
    }

    submitBtn.addEventListener("click", checkPassword);
    passwordInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter") checkPassword();
    });

    // Search and Filter
    const searchInput = document.getElementById("search-input");
    const filterBtns = document.querySelectorAll(".filter-btn");
    let currentFilter = "all";

    searchInput.addEventListener("input", filterTable);
    filterBtns.forEach(btn => {
      btn.addEventListener("click", () => {
        filterBtns.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        currentFilter = btn.dataset.filter;
        filterTable();
      });
    });

    function filterTable() {
      const searchTerm = searchInput.value.toLowerCase();
      const rows = document.querySelectorAll("#outreach tbody tr");
      
      rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        const statusCell = row.querySelector(".status-badge");
        const status = statusCell ? statusCell.textContent.toLowerCase() : "";
        
        const matchesSearch = text.includes(searchTerm);
        const matchesFilter = 
          currentFilter === "all" ||
          (currentFilter === "contacted" && status.includes("contacted")) ||
          (currentFilter === "pending" && status.includes("pending")) ||
          (currentFilter === "responded" && row.cells[11].textContent.trim() !== "—");
        
        row.style.display = matchesSearch && matchesFilter ? "" : "none";
      });
    }

    // Data Loading
    async function loadSheet() {
      const SHEET_ID = "1tkKpTWBxWff4O-wsWLQBh7PvgeJCD-y2RomUpb3INa0";
      const SHEET_NAME = "Sheet1";
      const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(SHEET_NAME)}`;
      
      try {
        const raw = await fetch(url).then(r => r.text());
        const json = JSON.parse(raw.substring(47, raw.length - 2));
        const rows = json.table.rows || [];
        const tbody = document.querySelector("#outreach tbody");
        tbody.innerHTML = "";
        
        document.querySelector(".loading").style.display = "none";
        
        const val = (r, i) => r.c[i]?.v ?? "";
        
        let totalCount = 0;
        let contactedCount = 0;
        let responseCount = 0;
        
        rows.slice(1).forEach(r => {
          totalCount++;
          const tr = document.createElement("tr");
          
          const contacted = String(val(r, 7)).toLowerCase();
          if (contacted.includes("✅")) contactedCount++;
          
          const response = String(val(r, 9)).trim();
          if (response && response !== "-" && response !== "") responseCount++;
          
          const ig = String(val(r, 5)).replace("@", "").trim();
          const li = String(val(r, 6)).trim();
          const web = String(val(r, 7)).trim();
          const fixUrl = x => x ? (/^https?:\/\//i.test(x) ? x : "https://" + x) : "";
          
          const statusClass = contacted.includes("✅") ? "status-contacted" : "status-pending";
          const statusText = contacted.includes("✅") ? "Contacted" : "Pending";
          
          const priority = String(val(r, 11)).trim();
          const stars = priority.split("⭐").length - 1;
          const priorityDisplay = stars > 0 ? "★".repeat(stars) : "—";
          
          tr.innerHTML = `
            <td>${val(r, 0) || "—"}</td>
            <td>${val(r, 1) || "—"}</td>
            <td>${val(r, 2) || "—"}</td>
            <td>${val(r, 3) || "—"}</td>
            <td>${val(r, 4) ? `<a href="mailto:${val(r, 4)}">${val(r, 4)}</a>` : "—"}</td>
            <td>${ig ? `<a href="https://instagram.com/${ig}" target="_blank">@${ig}</a>` : "—"}</td>
            <td>${li ? `<a href="${fixUrl(li)}" target="_blank">View</a>` : "—"}</td>
            <td>${web ? `<a href="${fixUrl(web)}" target="_blank">Visit</a>` : "—"}</td>
            <td>${val(r, 8) || "—"}</td>
            <td><span class="status-badge ${statusClass}">${statusText}</span></td>
            <td>${val(r, 9) || "—"}</td>
            <td>${val(r, 9) || "—"}</td>
            <td>${val(r, 10) || "—"}</td>
            <td><span class="priority">${priorityDisplay}</span></td>
          `;
          
          tbody.appendChild(tr);
        });
        
        const successRate = contactedCount > 0 ? Math.round((responseCount / contactedCount) * 100) : 0;
        
        animateValue("total-count", 0, totalCount, 1500);
        animateValue("contacted-count", 0, contactedCount, 1500);
        animateValue("response-count", 0, responseCount, 1500);
        document.getElementById("success-rate").textContent = successRate + "%";
        
      } catch (e) {
        console.error("Data sync error", e);
        const tbody = document.querySelector("#outreach tbody");
        tbody.innerHTML = `<tr><td colspan="14" style="padding:3rem;text-align:center;color:var(--text-muted);">Failed to load data. Check sheet sharing settings.</td></tr>`;
        document.querySelector(".loading").style.display = "none";
      }
    }

    function animateValue(id, start, end, duration) {
      const element = document.getElementById(id);
      const range = end - start;
      const increment = range / (duration / 16);
      let current = start;
      
      const timer = setInterval(() => {
        current += increment;
        if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
          current = end;
          clearInterval(timer);
        }
        element.textContent = Math.round(current);
      }, 16);
    }

    setInterval(loadSheet, 5 * 60 * 1000);
  </script>
</body>
</html>
